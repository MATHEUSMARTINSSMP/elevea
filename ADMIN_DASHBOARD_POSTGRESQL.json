{
  "name": "Admin Dashboard - PostgreSQL",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "GET",
        "path": "api/admin/dashboard",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "webhook-dashboard",
      "name": "ğŸ“Š Webhook - Admin Dashboard",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [240, 300],
      "webhookId": "elevea-admin-dashboard"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT client_id, site_slug, email, name, plan, status, manual_block, block_reason, created_at, updated_at, blocked_at FROM elevea.clients ORDER BY created_at DESC",
        "options": {}
      },
      "id": "postgres-get-all-clients",
      "name": "ğŸ‘¥ PostgreSQL - Get All Clients",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [460, 300],
      "credentials": {
        "postgres": {
          "id": "S2Hp22T5AgilJMEy",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT COUNT(*) as total, COUNT(CASE WHEN status = 'active' THEN 1 END) as active, COUNT(CASE WHEN status = 'blocked' THEN 1 END) as blocked, COUNT(CASE WHEN status = 'paused' THEN 1 END) as paused, COUNT(CASE WHEN manual_block = true THEN 1 END) as manual_blocked FROM elevea.clients",
        "options": {}
      },
      "id": "postgres-get-stats",
      "name": "ğŸ“ˆ PostgreSQL - Get Stats",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [460, 500],
      "credentials": {
        "postgres": {
          "id": "S2Hp22T5AgilJMEy",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT COUNT(*) as total, SUM(amount_paid) as total_revenue, COUNT(CASE WHEN status = 'approved' THEN 1 END) as approved, COUNT(CASE WHEN status = 'pending' THEN 1 END) as pending, COUNT(CASE WHEN status = 'rejected' THEN 1 END) as rejected FROM elevea.payments",
        "options": {}
      },
      "id": "postgres-get-payments-stats",
      "name": "ğŸ’° PostgreSQL - Get Payments Stats",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [460, 700],
      "credentials": {
        "postgres": {
          "id": "S2Hp22T5AgilJMEy",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT site_slug, payment_date, amount_paid, status FROM elevea.payments WHERE status = 'approved' ORDER BY payment_date DESC LIMIT 10",
        "options": {}
      },
      "id": "postgres-get-recent-payments",
      "name": "ğŸ’³ PostgreSQL - Get Recent Payments",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [460, 900],
      "credentials": {
        "postgres": {
          "id": "S2Hp22T5AgilJMEy",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {
          "keepDataFromAllInputs": true
        }
      },
      "id": "merge-dashboard-data",
      "name": "ğŸ”€ Merge - Dashboard Data",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [680, 600]
    },
    {
      "parameters": {
        "jsCode": "// Consolidar dados do dashboard\n// Merge node combina todos os dados em um Ãºnico array\n// Precisamos identificar cada tipo de dado pelo conteÃºdo\nconst inputData = $input.all();\n\nlet clients = [];\nlet stats = { total: 0, active: 0, blocked: 0, paused: 0, manual_blocked: 0 };\nlet paymentsStats = { total: 0, total_revenue: 0, approved: 0, pending: 0, rejected: 0 };\nlet recentPayments = [];\n\n// Processar cada item do merge\nfor (const item of inputData) {\n  const data = item.json;\n  \n  // Identificar tipo de dado pelo conteÃºdo\n  // Clientes: tem client_id ou site_slug sem total/active\n  if (data.client_id || (data.site_slug && !data.total && !data.active)) {\n    if (data.rows && Array.isArray(data.rows)) {\n      clients = data.rows;\n    } else if (Array.isArray(data)) {\n      clients = data;\n    } else {\n      clients.push(data);\n    }\n  }\n  // Stats: tem total e active\n  else if (data.total !== undefined && data.active !== undefined) {\n    const statsRow = data.rows ? data.rows[0] : data;\n    stats = {\n      total: parseInt(statsRow.total) || 0,\n      active: parseInt(statsRow.active) || 0,\n      blocked: parseInt(statsRow.blocked) || 0,\n      paused: parseInt(statsRow.paused) || 0,\n      manual_blocked: parseInt(statsRow.manual_blocked) || 0\n    };\n  }\n  // Payments Stats: tem total_revenue\n  else if (data.total_revenue !== undefined || (data.total !== undefined && data.approved !== undefined && !data.active)) {\n    const paymentsRow = data.rows ? data.rows[0] : data;\n    paymentsStats = {\n      total: parseInt(paymentsRow.total) || 0,\n      total_revenue: parseFloat(paymentsRow.total_revenue) || 0,\n      approved: parseInt(paymentsRow.approved) || 0,\n      pending: parseInt(paymentsRow.pending) || 0,\n      rejected: parseInt(paymentsRow.rejected) || 0\n    };\n  }\n  // Recent Payments: tem payment_date\n  else if (data.payment_date || (data.rows && data.rows.length > 0 && data.rows[0].payment_date)) {\n    if (data.rows && Array.isArray(data.rows)) {\n      recentPayments = data.rows;\n    } else if (Array.isArray(data)) {\n      recentPayments = data;\n    } else {\n      recentPayments.push(data);\n    }\n  }\n}\n\n// Formatar resposta\nreturn [{\n  json: {\n    success: true,\n    timestamp: new Date().toISOString(),\n    stats: {\n      clients: stats,\n      payments: paymentsStats\n    },\n    clients: clients.map(c => ({\n      client_id: c.client_id,\n      site_slug: c.site_slug,\n      email: c.email,\n      name: c.name,\n      plan: c.plan || 'essencial',\n      status: c.status || 'active',\n      manual_block: c.manual_block || false,\n      block_reason: c.block_reason,\n      created_at: c.created_at,\n      updated_at: c.updated_at,\n      blocked_at: c.blocked_at\n    })),\n    recent_payments: recentPayments.map(p => ({\n      site_slug: p.site_slug,\n      payment_date: p.payment_date,\n      amount_paid: parseFloat(p.amount_paid) || 0,\n      status: p.status\n    }))\n  }\n}];"
      },
      "id": "code-consolidate-dashboard",
      "name": "ğŸ§© Code - Consolidate Dashboard",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 600]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseCode": 200
        }
      },
      "id": "respond-dashboard",
      "name": "ğŸ“¤ Respond - Dashboard",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [900, 600]
    },
    {
      "parameters": {
        "httpMethod": "GET",
        "path": "admin/client-stats",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "webhook-client-stats",
      "name": "ğŸ“Š Webhook - Client Stats",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [240, 1200],
      "webhookId": "elevea-client-stats"
    },
    {
      "parameters": {
        "jsCode": "// Extrair parÃ¢metros da query string\nconst queryParams = $json.query || {};\nconst siteSlug = queryParams.siteSlug || queryParams.site_slug || null;\nconst email = queryParams.email || null;\n\nif (!siteSlug && !email) {\n  return [{\n    json: {\n      success: false,\n      code: 400,\n      message: 'siteSlug ou email Ã© obrigatÃ³rio',\n      timestamp: new Date().toISOString()\n    }\n  }];\n}\n\nreturn [{\n  json: {\n    success: true,\n    site_slug: siteSlug,\n    email: email\n  }\n}];"
      },
      "id": "code-extract-client-params",
      "name": "ğŸ” Code - Extract Client Params",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 1200]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.success }}",
              "value2": true
            }
          ]
        }
      },
      "id": "if-invalid-params",
      "name": "ğŸ”€ IF - Valid Params",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [680, 1200]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseCode": "={{ $json.code || 400 }}"
        }
      },
      "id": "respond-error-params",
      "name": "âŒ Respond - Error Params",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [680, 1400]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT client_id, site_slug, email, name, plan, status, manual_block, block_reason, created_at, updated_at, blocked_at FROM elevea.clients WHERE site_slug = $1 OR email = $2 LIMIT 1",
        "options": {
          "queryReplacement": "={{ [$json.site_slug || '', $json.email || ''] }}"
        }
      },
      "id": "postgres-get-client-stats",
      "name": "ğŸ‘¤ PostgreSQL - Get Client Stats",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [900, 1100],
      "credentials": {
        "postgres": {
          "id": "S2Hp22T5AgilJMEy",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT COUNT(*) as total, SUM(amount_paid) as total_paid, COUNT(CASE WHEN status = 'approved' THEN 1 END) as approved_count, MAX(payment_date) as last_payment_date FROM elevea.payments WHERE site_slug = $1",
        "options": {
          "queryReplacement": "={{ [$json.site_slug || ''] }}"
        }
      },
      "id": "postgres-get-client-payments",
      "name": "ğŸ’° PostgreSQL - Get Client Payments",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [900, 1300],
      "credentials": {
        "postgres": {
          "id": "S2Hp22T5AgilJMEy",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Consolidar estatÃ­sticas do cliente\nconst clientData = $('ğŸ‘¤ PostgreSQL - Get Client Stats').first();\nconst paymentsData = $('ğŸ’° PostgreSQL - Get Client Payments').first();\n\n// Processar dados do cliente\nlet client = null;\nif (clientData && clientData.json) {\n  const clientRow = clientData.json.rows ? clientData.json.rows[0] : clientData.json;\n  if (clientRow && clientRow.client_id) {\n    client = clientRow;\n  }\n}\n\nif (!client) {\n  return [{\n    json: {\n      success: false,\n      code: 404,\n      message: 'Cliente nÃ£o encontrado',\n      timestamp: new Date().toISOString()\n    }\n  }];\n}\n\n// Processar estatÃ­sticas de pagamentos\nlet paymentsStats = { total: 0, total_paid: 0, approved_count: 0, last_payment_date: null };\nif (paymentsData && paymentsData.json) {\n  const paymentsRow = paymentsData.json.rows ? paymentsData.json.rows[0] : paymentsData.json;\n  paymentsStats = {\n    total: parseInt(paymentsRow.total) || 0,\n    total_paid: parseFloat(paymentsRow.total_paid) || 0,\n    approved_count: parseInt(paymentsRow.approved_count) || 0,\n    last_payment_date: paymentsRow.last_payment_date\n  };\n}\n\n// Calcular dias desde Ãºltimo pagamento\nlet daysSinceLastPayment = null;\nif (paymentsStats.last_payment_date) {\n  const lastPayment = new Date(paymentsStats.last_payment_date);\n  const now = new Date();\n  daysSinceLastPayment = Math.floor((now - lastPayment) / (1000 * 60 * 60 * 24));\n}\n\nreturn [{\n  json: {\n    success: true,\n    timestamp: new Date().toISOString(),\n    client: {\n      client_id: client.client_id,\n      site_slug: client.site_slug,\n      email: client.email,\n      name: client.name,\n      plan: client.plan || 'essencial',\n      status: client.status || 'active',\n      manual_block: client.manual_block || false,\n      block_reason: client.block_reason,\n      created_at: client.created_at,\n      updated_at: client.updated_at,\n      blocked_at: client.blocked_at\n    },\n    stats: {\n      payments: paymentsStats,\n      days_since_last_payment: daysSinceLastPayment\n    }\n  }\n}];"
      },
      "id": "code-format-client-stats",
      "name": "ğŸ“Š Code - Format Client Stats",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1120, 1200]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseCode": "={{ $json.code || 200 }}"
        }
      },
      "id": "respond-client-stats",
      "name": "ğŸ“¤ Respond - Client Stats",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1340, 1200]
    },
    {
      "parameters": {
        "httpMethod": "GET",
        "path": "admin/system-health",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "webhook-system-health",
      "name": "ğŸ¥ Webhook - System Health",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [240, 1600],
      "webhookId": "elevea-system-health"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT COUNT(*) as total_clients, COUNT(CASE WHEN status = 'active' THEN 1 END) as active_clients, COUNT(CASE WHEN status = 'blocked' THEN 1 END) as blocked_clients, COUNT(CASE WHEN payment_warning = true THEN 1 END) as warning_clients FROM elevea.clients",
        "options": {}
      },
      "id": "postgres-get-system-stats",
      "name": "ğŸ“Š PostgreSQL - Get System Stats",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [460, 1600],
      "credentials": {
        "postgres": {
          "id": "S2Hp22T5AgilJMEy",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT COUNT(*) as total_payments, COUNT(CASE WHEN status = 'approved' THEN 1 END) as approved_payments, COUNT(CASE WHEN status = 'pending' THEN 1 END) as pending_payments, COUNT(CASE WHEN status = 'rejected' THEN 1 END) as rejected_payments, COUNT(CASE WHEN payment_date > NOW() - INTERVAL '30 days' THEN 1 END) as payments_last_30_days FROM elevea.payments",
        "options": {}
      },
      "id": "postgres-get-payments-health",
      "name": "ğŸ’° PostgreSQL - Get Payments Health",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [460, 1800],
      "credentials": {
        "postgres": {
          "id": "S2Hp22T5AgilJMEy",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Consolidar saÃºde do sistema\nconst systemStatsData = $('ğŸ“Š PostgreSQL - Get System Stats').first();\nconst paymentsHealthData = $('ğŸ’° PostgreSQL - Get Payments Health').first();\n\n// Processar estatÃ­sticas do sistema\nlet systemStats = { total_clients: 0, active_clients: 0, blocked_clients: 0, warning_clients: 0 };\nif (systemStatsData && systemStatsData.json) {\n  const statsRow = systemStatsData.json.rows ? systemStatsData.json.rows[0] : systemStatsData.json;\n  systemStats = {\n    total_clients: parseInt(statsRow.total_clients) || 0,\n    active_clients: parseInt(statsRow.active_clients) || 0,\n    blocked_clients: parseInt(statsRow.blocked_clients) || 0,\n    warning_clients: parseInt(statsRow.warning_clients) || 0\n  };\n}\n\n// Processar saÃºde dos pagamentos\nlet paymentsHealth = { total_payments: 0, approved_payments: 0, pending_payments: 0, rejected_payments: 0, payments_last_30_days: 0 };\nif (paymentsHealthData && paymentsHealthData.json) {\n  const healthRow = paymentsHealthData.json.rows ? paymentsHealthData.json.rows[0] : paymentsHealthData.json;\n  paymentsHealth = {\n    total_payments: parseInt(healthRow.total_payments) || 0,\n    approved_payments: parseInt(healthRow.approved_payments) || 0,\n    pending_payments: parseInt(healthRow.pending_payments) || 0,\n    rejected_payments: parseInt(healthRow.rejected_payments) || 0,\n    payments_last_30_days: parseInt(healthRow.payments_last_30_days) || 0\n  };\n}\n\n// Calcular mÃ©tricas de saÃºde\nconst activePercentage = systemStats.total_clients > 0 ? (systemStats.active_clients / systemStats.total_clients * 100).toFixed(2) : 0;\nconst approvalRate = paymentsHealth.total_payments > 0 ? (paymentsHealth.approved_payments / paymentsHealth.total_payments * 100).toFixed(2) : 0;\n\n// Determinar status geral\nlet overallStatus = 'healthy';\nlet alerts = [];\n\nif (systemStats.blocked_clients > systemStats.total_clients * 0.2) {\n  overallStatus = 'warning';\n  alerts.push('Mais de 20% dos clientes estÃ£o bloqueados');\n}\n\nif (systemStats.warning_clients > 0) {\n  alerts.push(`${systemStats.warning_clients} cliente(s) com aviso de pagamento`);\n}\n\nif (paymentsHealth.pending_payments > paymentsHealth.total_payments * 0.1) {\n  overallStatus = 'warning';\n  alerts.push('Mais de 10% dos pagamentos estÃ£o pendentes');\n}\n\nif (parseFloat(approvalRate) < 80) {\n  overallStatus = 'warning';\n  alerts.push(`Taxa de aprovaÃ§Ã£o de pagamentos abaixo de 80% (${approvalRate}%)`);\n}\n\nreturn [{\n  json: {\n    success: true,\n    timestamp: new Date().toISOString(),\n    status: overallStatus,\n    metrics: {\n      clients: systemStats,\n      payments: paymentsHealth,\n      active_percentage: parseFloat(activePercentage),\n      approval_rate: parseFloat(approvalRate)\n    },\n    alerts: alerts\n  }\n}];"
      },
      "id": "code-format-system-health",
      "name": "ğŸ¥ Code - Format System Health",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 1700]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseCode": 200
        }
      },
      "id": "respond-system-health",
      "name": "ğŸ“¤ Respond - System Health",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [900, 1700]
    },
    {
      "parameters": {
        "httpMethod": "GET",
        "path": "admin/revenue-stats",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "webhook-revenue-stats",
      "name": "ğŸ’° Webhook - Revenue Stats",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [240, 2200],
      "webhookId": "elevea-revenue-stats"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT SUM(amount_paid) as total_revenue, COUNT(*) as total_payments, AVG(amount_paid) as avg_payment FROM elevea.payments WHERE status = 'approved'",
        "options": {}
      },
      "id": "postgres-get-revenue-total",
      "name": "ğŸ’° PostgreSQL - Get Revenue Total",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [460, 2200],
      "credentials": {
        "postgres": {
          "id": "S2Hp22T5AgilJMEy",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT DATE_TRUNC('month', payment_date) as month, SUM(amount_paid) as revenue, COUNT(*) as payments FROM elevea.payments WHERE status = 'approved' AND payment_date >= NOW() - INTERVAL '12 months' GROUP BY DATE_TRUNC('month', payment_date) ORDER BY month DESC",
        "options": {}
      },
      "id": "postgres-get-revenue-monthly",
      "name": "ğŸ“… PostgreSQL - Get Revenue Monthly",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [460, 2400],
      "credentials": {
        "postgres": {
          "id": "S2Hp22T5AgilJMEy",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT plan, COUNT(*) as clients, SUM(amount_paid) as revenue FROM elevea.clients c LEFT JOIN elevea.payments p ON c.site_slug = p.site_slug AND p.status = 'approved' GROUP BY plan",
        "options": {}
      },
      "id": "postgres-get-revenue-by-plan",
      "name": "ğŸ“Š PostgreSQL - Get Revenue By Plan",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [460, 2600],
      "credentials": {
        "postgres": {
          "id": "S2Hp22T5AgilJMEy",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Consolidar estatÃ­sticas de receita\nconst revenueTotalData = $('ğŸ’° PostgreSQL - Get Revenue Total').first();\nconst revenueMonthlyData = $('ğŸ“… PostgreSQL - Get Revenue Monthly').all();\nconst revenueByPlanData = $('ğŸ“Š PostgreSQL - Get Revenue By Plan').all();\n\n// Processar receita total\nlet revenueTotal = { total_revenue: 0, total_payments: 0, avg_payment: 0 };\nif (revenueTotalData && revenueTotalData.json) {\n  const totalRow = revenueTotalData.json.rows ? revenueTotalData.json.rows[0] : revenueTotalData.json;\n  revenueTotal = {\n    total_revenue: parseFloat(totalRow.total_revenue) || 0,\n    total_payments: parseInt(totalRow.total_payments) || 0,\n    avg_payment: parseFloat(totalRow.avg_payment) || 0\n  };\n}\n\n// Processar receita mensal\nlet monthlyRevenue = [];\nif (revenueMonthlyData.length > 0) {\n  const monthlyRows = revenueMonthlyData[0].json.rows || revenueMonthlyData[0].json || [];\n  monthlyRevenue = Array.isArray(monthlyRows) ? monthlyRows : [monthlyRows];\n  monthlyRevenue = monthlyRevenue.map(r => ({\n    month: r.month,\n    revenue: parseFloat(r.revenue) || 0,\n    payments: parseInt(r.payments) || 0\n  }));\n}\n\n// Processar receita por plano\nlet revenueByPlan = [];\nif (revenueByPlanData.length > 0) {\n  const planRows = revenueByPlanData[0].json.rows || revenueByPlanData[0].json || [];\n  revenueByPlan = Array.isArray(planRows) ? planRows : [planRows];\n  revenueByPlan = revenueByPlan.map(r => ({\n    plan: r.plan || 'essencial',\n    clients: parseInt(r.clients) || 0,\n    revenue: parseFloat(r.revenue) || 0\n  }));\n}\n\n// Calcular crescimento mensal\nlet monthlyGrowth = [];\nfor (let i = 1; i < monthlyRevenue.length; i++) {\n  const current = monthlyRevenue[i - 1].revenue;\n  const previous = monthlyRevenue[i].revenue;\n  const growth = previous > 0 ? ((current - previous) / previous * 100).toFixed(2) : 0;\n  monthlyGrowth.push({\n    month: monthlyRevenue[i - 1].month,\n    growth: parseFloat(growth)\n  });\n}\n\nreturn [{\n  json: {\n    success: true,\n    timestamp: new Date().toISOString(),\n    total: revenueTotal,\n    monthly: monthlyRevenue,\n    by_plan: revenueByPlan,\n    growth: monthlyGrowth\n  }\n}];"
      },
      "id": "code-format-revenue-stats",
      "name": "ğŸ’° Code - Format Revenue Stats",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 2300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseCode": 200
        }
      },
      "id": "respond-revenue-stats",
      "name": "ğŸ“¤ Respond - Revenue Stats",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [900, 2300]
    }
  ],
  "connections": {
    "ğŸ“Š Webhook - Admin Dashboard": {
      "main": [
        [
          {
            "node": "ğŸ‘¥ PostgreSQL - Get All Clients",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“ˆ PostgreSQL - Get Stats",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ’° PostgreSQL - Get Payments Stats",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ’³ PostgreSQL - Get Recent Payments",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ‘¥ PostgreSQL - Get All Clients": {
      "main": [
        [
          {
            "node": "ğŸ§© Code - Consolidate Dashboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ˆ PostgreSQL - Get Stats": {
      "main": [
        [
          {
            "node": "ğŸ§© Code - Consolidate Dashboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’° PostgreSQL - Get Payments Stats": {
      "main": [
        [
          {
            "node": "ğŸ§© Code - Consolidate Dashboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’³ PostgreSQL - Get Recent Payments": {
      "main": [
        [
          {
            "node": "ğŸ§© Code - Consolidate Dashboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ‘¥ PostgreSQL - Get All Clients": {
      "main": [
        [
          {
            "node": "ğŸ”€ Merge - Dashboard Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ˆ PostgreSQL - Get Stats": {
      "main": [
        [
          {
            "node": "ğŸ”€ Merge - Dashboard Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’° PostgreSQL - Get Payments Stats": {
      "main": [
        [
          {
            "node": "ğŸ”€ Merge - Dashboard Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’³ PostgreSQL - Get Recent Payments": {
      "main": [
        [
          {
            "node": "ğŸ”€ Merge - Dashboard Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”€ Merge - Dashboard Data": {
      "main": [
        [
          {
            "node": "ğŸ§© Code - Consolidate Dashboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ§© Code - Consolidate Dashboard": {
      "main": [
        [
          {
            "node": "ğŸ“¤ Respond - Dashboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š Webhook - Client Stats": {
      "main": [
        [
          {
            "node": "ğŸ” Code - Extract Client Params",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” Code - Extract Client Params": {
      "main": [
        [
          {
            "node": "ğŸ”€ IF - Invalid Params",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”€ IF - Valid Params": {
      "main": [
        [
          {
            "node": "ğŸ‘¤ PostgreSQL - Get Client Stats",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ’° PostgreSQL - Get Client Payments",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "âŒ Respond - Error Params",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ‘¤ PostgreSQL - Get Client Stats": {
      "main": [
        [
          {
            "node": "ğŸ“Š Code - Format Client Stats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’° PostgreSQL - Get Client Payments": {
      "main": [
        [
          {
            "node": "ğŸ“Š Code - Format Client Stats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š Code - Format Client Stats": {
      "main": [
        [
          {
            "node": "ğŸ“¤ Respond - Client Stats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¥ Webhook - System Health": {
      "main": [
        [
          {
            "node": "ğŸ“Š PostgreSQL - Get System Stats",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ’° PostgreSQL - Get Payments Health",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š PostgreSQL - Get System Stats": {
      "main": [
        [
          {
            "node": "ğŸ¥ Code - Format System Health",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’° PostgreSQL - Get Payments Health": {
      "main": [
        [
          {
            "node": "ğŸ¥ Code - Format System Health",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¥ Code - Format System Health": {
      "main": [
        [
          {
            "node": "ğŸ“¤ Respond - System Health",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’° Webhook - Revenue Stats": {
      "main": [
        [
          {
            "node": "ğŸ’° PostgreSQL - Get Revenue Total",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“… PostgreSQL - Get Revenue Monthly",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“Š PostgreSQL - Get Revenue By Plan",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’° PostgreSQL - Get Revenue Total": {
      "main": [
        [
          {
            "node": "ğŸ’° Code - Format Revenue Stats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“… PostgreSQL - Get Revenue Monthly": {
      "main": [
        [
          {
            "node": "ğŸ’° Code - Format Revenue Stats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š PostgreSQL - Get Revenue By Plan": {
      "main": [
        [
          {
            "node": "ğŸ’° Code - Format Revenue Stats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’° Code - Format Revenue Stats": {
      "main": [
        [
          {
            "node": "ğŸ“¤ Respond - Revenue Stats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 4,
  "updatedAt": "2025-01-XX",
  "versionId": "1"
}

